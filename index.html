<!DOCTYPE html>
<html lang="ja" class="morning">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<title>æœæ”¯åº¦</title>

<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png"> 



<style>

:root{
  /* èƒŒæ™¯ã€œå‰æ™¯ */
  --bg1:#1b2630;  /* è’¼ã«ç°ã‚’æ··ãœãŸå¤œæ˜ã‘å‰ */
  --bg2:#2b3845;  /* ä¸‹ã«å‘ã‹ã£ã¦æ˜ã‚‹ãã€å¤œã®æ®‹å…‰ã‚’æ®‹ã™ */
  --fg:#f5f7fa;   /* æŸ”ã‚‰ã‹ã„ç™½ */
  --muted:#b6c2cc;/* æœé„ã®ã‚ˆã†ãªç°é’ */

  /* ãƒ‘ãƒãƒ«ãƒ»è£…é£¾ */
  --panel:rgba(255,255,255,.12);
  --panel-br:rgba(255,255,255,.25);

  /* æ¸©å…‰ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼ˆæœæ—¥ï¼‰ */
  --warm1:#ffd98e; /* æ·¡ã„æ©™å…‰ */
  --warm2:#ffb965; /* æœé™½ã®æ©™ */

  /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ©ãƒ¼ */
  --ok:#60d9a3;    /* æ¾„ã‚“ã é’ç·‘ï¼ˆè»½å¿«æ„Ÿï¼‰ */
  --warn:#ffb65f;  /* æŸ”ã‚‰ã‹ã„è­¦å‘Š */
  --danger:#ff6b6b;/* è–„èµ¤ã§çµ±ä¸€ */

  --panel-bg: rgba(255,255,255,.08);
  --panel-line: rgba(255,255,255,.15);

  --block-bg: rgba(255,255,255,.05);
  --block-line: rgba(255,255,255,.12); 
  --input-bg: #0b1621;
  --input-fg: var(--fg);
  --input-br: rgba(255,255,255,.15);

  --btn-bg: rgba(255,255,255,.06);
  --btn-line: rgba(255,255,255,.18);

  --progress-bg: rgba(255,255,255,.08);

  --mask-bg: rgba(0,0,0,.35);
  --drawer-bg: rgba(20,28,40,.95);
  --drawer-br: rgba(255,255,255,.18);

  }


/* ğŸŒ… æœãƒ†ãƒ¼ãƒ */
:root.morning{
  /* èƒŒæ™¯ï¼šå¤œæ˜ã‘ã®ç©ºã‚’æ„è­˜ */
  --bg1:#1b2630;  /* è’¼ã«ç°ã‚’æ··ãœãŸå¤œæ˜ã‘å‰ */
  --bg2:#2b3845;  /* ä¸‹ã«å‘ã‹ã£ã¦æ˜ã‚‹ãã€å¤œã®æ®‹å…‰ã‚’æ®‹ã™ */
  --fg:#f5f7fa;   /* æŸ”ã‚‰ã‹ã„ç™½ */
  --muted:#b6c2cc;/* æœé„ã®ã‚ˆã†ãªç°é’ */


  /* ãƒ‘ãƒãƒ«ãƒ»ãƒ–ãƒ­ãƒƒã‚¯ */
  --panel:rgba(255,255,255,.12);
  --panel-br:rgba(255,255,255,.25);
  --block-bg: rgba(255,255,255,.05);
  --block-line: rgba(255,255,255,.12); 


  /* å…¥åŠ›ãƒ»ãƒœã‚¿ãƒ³ */
  --input-bg:rgba(255,255,255,.75);
  --input-fg:#1c242c;
  --input-br:rgba(160,130,80,.25);
  --btn-bg: rgba(255,255,255,.06);
  --btn-line: rgba(255,255,255,.18);


  /* æ¸©å…‰ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼ˆæœæ—¥ï¼‰ */
  --warm1:#ffd98e;	 /* æ·¡ã„æ©™å…‰ */
  --warm2:#ffb965;	 /* æœé™½ã®æ©™ */
  --progress-bg:rgba(0,0,0,.06);

 /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ©ãƒ¼ */
  --ok:#60d9a3;    /* æ¾„ã‚“ã é’ç·‘ï¼ˆè»½å¿«æ„Ÿï¼‰ */
  --warn:#ffb65f;  /* æŸ”ã‚‰ã‹ã„è­¦å‘Š */
  --danger:#ff6b6b;/* è–„èµ¤ã§çµ±ä¸€ */

  /* ãƒ‰ãƒ­ãƒ¯ãƒ¼/ãƒã‚¹ã‚¯ */
  --mask-bg: rgba(0,0,0,.35);
  --drawer-bg: rgba(20,28,40,.90);
  --drawer-br: rgba(255,255,255,.18);


  /* ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆèµ¤Ã—ç´ºãƒˆãƒ¼ãƒ³ã‚’æŸ”ã‚‰ã‹ãï¼‰ */
  --toast-bg:#253448;
  --toast-fg:#ff7b6b;
  --toast-br:rgba(255,123,107,.3);
  --toast-shadow:0 6px 18px rgba(255,123,107,.18);
}


body{
  margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--fg);
  font-family:system-ui,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif; height:100svh; overflow:hidden; transition:background none;
}
/* çŠ¶æ…‹åˆ¥èƒŒæ™¯ */
body.active{
  background: radial-gradient(800px 600px at 50% 0%, rgba(255,220,150,.25), transparent 60%),
              linear-gradient(180deg,#24303a,#1b2630);
}
body.reward{
  background: radial-gradient(900px 700px at 50% 0%, rgba(50, 150, 255, .35), transparent 60%),
              linear-gradient(180deg, #13253b, #0d1722);
}
body.delay{
  background: radial-gradient(1200px 800px at 50% 0%, rgba(200,60,60,.25), transparent 60%),
              linear-gradient(180deg,#3a1a1a,#1b0a0a);
}

*{box-sizing:border-box} html,body{height:100%}

.app{display:grid;grid-template-rows:auto 1fr auto;gap:10px;height:100%;padding:12px;max-width:720px;margin:0 auto}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header{display:flex;align-items:center;justify-content:space-between}
.brand{font-weight:700;letter-spacing:.06em}
.modeBtn{appearance:none;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:var(--fg);
  padding:8px 10px;border-radius:12px;cursor:pointer}

/* ä¸Šæ®µ2ã‚«ãƒ©ãƒ  */
.main{display:grid;grid-template-rows:auto 1fr;gap:10px;min-height:0}
.top{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.panel{background:var(--panel);border:1px solid var(--panel-br);border-radius:14px;padding:12px;backdrop-filter:blur(6px)}

.block{
  background: var(--block-bg, rgba(255,255,255,.05));
  border: 1px solid var(--block-line, rgba(255,255,255,.12));
  border-radius: 12px; padding:10px;
}

/* ãƒ†ã‚­ã‚¹ãƒˆãƒ»è£…é£¾ */
.k {
  font-size: .8rem;
  color: var(--muted);
}
.v {
  font-variant-numeric: tabular-nums;
  font-size: 1.2rem;
  margin-top: 4px;
}
.big{font-size:1.8rem}
.big2{font-size:2.8rem}

.badge{padding:4px 8px;border-radius:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18)}

/* ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ */
.icon {
  appearance: none;
  border: 1px solid var(--btn-line, rgba(255,255,255,.18));
  background: var(--btn-bg, rgba(255,255,255,.06));
  color: var(--fg);
  padding: 4px 6px;
  border-radius: 10px;
  cursor: pointer;
  margin-left: 6px;
}
/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
.progress{ height:8px; background: var(--progress-bg, rgba(255,255,255,.08)); border-radius:999px; overflow:hidden }
.progress > div {
  height: 100%;
  background: linear-gradient(90deg, var(--warm1), var(--warm2));
  width: 0%;
}

/* çŠ¶æ…‹è‰² */
.ok { color: var(--ok); }
.warn { color: var(--warn); }
.danger { color: var(--danger); }




/* ä¸­æ®µï¼šæ®‹ã‚Šæ™‚é–“ï¼ˆ#remainï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´ */
.panel:nth-child(2) .block {
  display: flex;
  flex-direction: column;
  align-items: center;    /* ä¸­å¤®æƒãˆ */
  justify-content: center; /* ä¸­å¤®é…ç½®ã‚’å¼·åŒ– */
  overflow: hidden;       /* ã¯ã¿å‡ºã—é˜²æ­¢ã¯ç¶­æŒ */
  padding: 10px; 
}

/* ---------------------------------------------------- */
/* ãƒ‘ãƒãƒ«ä¼¸ç¸®ã¨ã‚ºãƒ¬ã‚’æ ¹çµ¶ã™ã‚‹ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
/* ---------------------------------------------------- */

#remain {
  /* â˜…é‡è¦ï¼šãƒ‘ãƒãƒ«ã®ä¼¸ç¸®ã‚’é˜²ããŸã‚ã€ååˆ†ãªå›ºå®šå¹…ã‚’ä¸ãˆã‚‹ */
  /* iPhone SE (320px) ã§ã‚‚åã¾ã‚Šã€ã‹ã¤ +100:00 ã‚‚å…¥ã‚‹å¹… */
  width: 260px;
  max-width: 100%; /* ç”»é¢ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ä¿é™º */

  /* â˜…é‡è¦ï¼šCSS Gridã§ã€Œ1:1ã€ã®æ¯”ç‡ã‚’ä½œã‚‹ */
  /* å·¦(1fr) : ã‚³ãƒ­ãƒ³(auto) : å³(1fr) */
  /* ã“ã‚Œã«ã‚ˆã‚Šã€å·¦å³ã®ä¸­èº«ãŒä½•ã§ã‚ã‚Œã€ã‚³ãƒ­ãƒ³ã¯å¸¸ã«ã€Œä¸­å¿ƒã€ã«æ¥ã‚‹ */
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: baseline;
  
  /* æ•°å­—ã®ç­‰å¹…è¨­å®š */
  font-feature-settings: "tnum"; 
  font-variant-numeric: tabular-nums; 
}

/* åˆ†ã‚¨ãƒªã‚¢ï¼šå³æƒãˆ */
.min-part {
  /* å¹…æŒ‡å®šã¯ä¸è¦ã€‚ã‚°ãƒªãƒƒãƒ‰ã® 1fr ãŒè‡ªå‹•çš„ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
  text-align: right; 
  padding-right: 2px; /* ã‚³ãƒ­ãƒ³ã¨ã®éš™é–“èª¿æ•´ */
  
  /* ã¯ã¿å‡ºã—é˜²æ­¢ã®å¿µæŠ¼ã— */
  white-space: nowrap;
}

/* ç§’ã‚¨ãƒªã‚¢ï¼šå·¦æƒãˆ */
.sec-part {
  /* å¹…æŒ‡å®šã¯ä¸è¦ã€‚ã‚°ãƒªãƒƒãƒ‰ã® 1fr ãŒè‡ªå‹•çš„ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
  text-align: left; 
  padding-left: 2px; /* ã‚³ãƒ­ãƒ³ã¨ã®éš™é–“èª¿æ•´ */
  
  /* ã¯ã¿å‡ºã—é˜²æ­¢ã®å¿µæŠ¼ã— */
  white-space: nowrap;
}

/* ğŸ“± ç”»é¢å¹…ãŒæ¥µç«¯ã«ç‹­ã„ç«¯æœ«å‘ã‘ã®å¾®èª¿æ•´ */
@media (max-width: 380px) { 
  #remain {
    /* ãƒ•ã‚©ãƒ³ãƒˆã‚’å°‘ã—ä¸‹ã’ã¦ã€å›ºå®šå¹…ã®ä¸­ã«ç¢ºå®Ÿã«åã‚ã‚‹ */
    font-size: 2.6rem; 
    width: 240px; /* å°‘ã—ç‹­ã‚ã‚‹ */
  }
}



/* ä¸­æ®µï¼šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆãƒ–ãƒ­ãƒƒã‚¯å†…ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«&ä¸‹å›ºå®šãƒœã‚¿ãƒ³ï¼‰ */

.listPanel{min-height:0;display:grid;grid-template-rows:auto 1fr auto;gap:8px}
.listHead{display:flex;justify-content:space-between;align-items:center}
.list{display:flex;flex-direction:column;gap:8px;overflow:auto;padding-top:6px}
.item{
  display:flex;gap:10px;align-items:center;
  background: var(--panel-bg, rgba(255,255,255,.08));
  border:1px solid var(--panel-line, rgba(255,255,255,.15));
  border-radius:12px;padding:8px}
.item input[type="checkbox"]{width:20px;height:20px}
.item input[type="text"]
  {flex:1;min-width:0;
  background: var(--input-bg, #0b1621);
  border:1px solid var(--input-br, rgba(255,255,255,.15));
  color:var(--input-fg, var(--fg));
  border-radius:10px;padding:8px}
.iBtn{
  background: var(--btn-bg, rgba(255,255,255,.06));
  border: 1px solid var(--btn-line, rgba(255,255,255,.18));
  color: var(--fg);
  padding:6px 8px;border-radius:10px
}

.resetWrap{display:flex;justify-content:flex-end}

/* ãƒ•ãƒƒã‚¿ãƒ¼ï¼šä¸­å¤®ã®å‹•çš„ãƒœã‚¿ãƒ³ï¼è¨­å®šã¯å³ä¸‹ã«å›ºå®š */
.footer{display:flex;align-items:center;justify-content:center;gap:10px;padding-bottom:calc(env(safe-area-inset-bottom,0) + 4px)}
.btn{appearance:none;border:none;border-radius:12px;padding:8px 20px;font-weight:700;cursor:pointer}
.btn.pri{background:linear-gradient(180deg,var(--warm1),var(--warm2));color:#28150a;box-shadow:0 8px 20px rgba(255,170,90,.35)}
.btn.gh {
  position: absolute;
  right: 16px;
  bottom: calc(12px + env(safe-area-inset-bottom, 0));
  background: rgba(255,255,255,.08);
  color: var(--fg);
  border: 1px solid rgba(255,255,255,.18);
  padding: 8px 12px;
  border-radius: 12px;
  transform: translateY(-4px);  /* å°‘ã—ä¸Šã’ã¦footerä¸­å¤®ã¨é«˜ã•ã‚’åˆã‚ã›ã‚‹ */
  z-index: 10;                   /* footerã‚ˆã‚Šå‰ã«å‡ºã™ */
}

/* ãƒ‰ãƒ­ãƒ¯ãƒ¼ï¼ˆä¸‹ã‹ã‚‰ï¼‰ */
.drawerMask {
  position: fixed;
  inset: 0;
  background: var(--mask-bg, rgba(0,0,0,.35));
  backdrop-filter: blur(2px);
  opacity: 0;
  pointer-events: none;
  transition: .2s;
  z-index: 40;
}

.drawer {
  position: fixed;
  left: 0; right: 0;
  bottom: -70vh;
  height: 60vh;
  background: var(--drawer-bg, rgba(20,28,40,.95));
  border-top: 1px solid var(--drawer-br, rgba(255,255,255,.18));
  border-radius: 16px 16px 0 0;
  padding: 14px;
  transition: .25s;
  box-shadow: 0 -12px 28px rgba(0,0,0,.35);
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 41;
}

body.show-drawer .drawerMask { opacity: 1; pointer-events: auto; }
body.show-drawer .drawer { bottom: 0; }

.row { display: flex; gap: 8px; align-items: center; }

/* è¨­å®šãƒ‰ãƒ­ãƒ¯ãƒ¼å†…ã®ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º */
.drawer .block {
    display: grid;
    grid-template-columns: 1fr 1fr; /* åºƒã„ç”»é¢ã§ã¯2ã‚«ãƒ©ãƒ ã‚’ç¶­æŒ */
    gap: 8px;
}


/* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
input[type="time"],
input[type="text"] {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--input-br, rgba(255,255,255,.15));
  background: var(--input-bg, #0b1621);
  font-size: 16px;
  color: var(--input-fg, var(--fg));
  /* iOS Safariãªã©ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’çµ±ä¸€ */
  -webkit-appearance: none;
  appearance: none;
}

/* ãƒ©ãƒ™ãƒ« */
label {
  color: var(--muted);
  font-size: .9rem;
}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.toast{
  position:fixed;
  left:20px; 
  bottom:calc(40px + env(safe-area-inset-bottom,0));
  max-width:min(80vw,420px);
  background: rgba(15, 20, 30, 0.94);
  color: #ff6b6b; /* èµ¤å¯„ã‚Šã®çŠç‘šè‰²æ–‡å­— */
  border: 1px solid rgba(255, 100, 100, 0.3);
  box-shadow: 0 4px 12px rgba(255, 0, 0, .25);
  font-weight: 600;
  padding:12px 14px;
  border-radius:12px;
  opacity:0;
  pointer-events:none;
  transition:opacity .4s, transform .4s;
  transform:translateX(-100px);
  z-index:50;
}
.toast.show{opacity:1;transform:translateX(0)}

/* ã”è¤’ç¾ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ ã®ä¸­ã«è¡¨ç¤ºã™ã‚‹ã”è¤’ç¾UI */
.rewardPane{display:flex;flex-direction:column;gap:10px}
.rewardTitle{font-weight:800;letter-spacing:.08em}
.rewardHint{color:var(--muted)}
.rewardRow{display:flex;gap:8px;flex-wrap:wrap}
.rBtn{border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);
  color:var(--fg);padding:8px 10px;border-radius:10px;cursor:pointer}


/* ğŸ’¡ lightCanvasç”¨CSSã‚’è¿½åŠ  */
#lightCanvas {
  position: fixed;
  top: 0;
  left: 0;
  /* ä¿®æ­£ç‚¹: Z-indexã‚’æœ€å‰é¢ï¼ˆä¾‹ï¼š1000ï¼‰ã«å¤‰æ›´ */
  z-index: 1000;
  pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚„ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡è¦–ã™ã‚‹ */
  opacity: 0; /* æœ€åˆã¯éè¡¨ç¤º */
  transition: opacity 1.5s ease; /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ã‚¢ã‚¦ãƒˆç”¨ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
}
/* ã”è¤’ç¾ãƒ¢ãƒ¼ãƒ‰æ™‚ã«é€éåº¦ã‚’å¤‰æ›´ */
body.reward #lightCanvas {
  opacity: 0.8; /* ğŸ’¡ ã”è¤’ç¾ãƒ¢ãƒ¼ãƒ‰æ™‚ã«æ·¡ãè¡¨ç¤º */
}


/* ğŸ’¡ ã”è¤’ç¾ãƒ¢ãƒ¼ãƒ‰æ™‚ã®UIè¦ç´ ã®é€éå‡¦ç†ã‚’è¿½åŠ  */
body.reward #timerPanel,
body.reward #listPanel,
body.reward #actionsPanel {
  /* ä¿®æ­£ç‚¹: ä¸é€æ˜åº¦ã‚’ä¸‹ã’ã€ç²’å­ã‚’é€ã‘ã•ã›ã‚‹ */
  opacity: 0.6; 
  /* é€éåº¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ»‘ã‚‰ã‹ãªå¤‰åŒ–ï¼‰ */
  transition: opacity 0.8s ease;
}

</style>
</head>
<body>


<script>
    // ============== ã€èªè¨¼è¨­å®šã‚¨ãƒªã‚¢ï¼šã“ã“ã ã‘ç·¨é›†ã™ã‚‹ã€‘ ==============

    const SECRET_KEY = "1122"; 

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹ã€‚
    const ACCESS_DENIED_MESSAGE = `
        <h1>ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚</h1>
        <p>æ­£ã—ã„èªè¨¼ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        <p>ãƒ„ãƒ¼ãƒ«ã®ã”åˆ©ç”¨ã«ã¯ã€èªè¨¼ã‚­ãƒ¼ã«ã‚ˆã‚‹ç¢ºèªãŒå¿…è¦ã§ã™ã€‚</p>
    `;
    // ==========================================================


    // ãƒ„ãƒ¼ãƒ«æœ¬ä½“ï¼ˆ<body>ã‚¿ã‚°å†…ã®å†…å®¹ï¼‰ã‚’ä¿è­·ã™ã‚‹ãƒ¡ã‚¤ãƒ³å‡¦ç†
    document.addEventListener('DOMContentLoaded', function() {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚’æ±‚ã‚ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
        const enteredKey = prompt("èªè¨¼ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");

        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        if (enteredKey !== SECRET_KEY) {
            // èªè¨¼å¤±æ•—æ™‚ï¼š<body>ã‚¿ã‚°ã®ä¸­èº«ã‚’å…¨ã¦æ¶ˆå»ã—ã€æ‹’å¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç½®ãæ›ãˆã‚‹
            document.body.innerHTML = ACCESS_DENIED_MESSAGE;
            
            // é‡è¦ãªç‚¹: èªè¨¼å¤±æ•—å¾Œã¯ã€ãã®å¾Œã®å…¨ã¦ã®JavaScriptã®å®Ÿè¡Œã‚’åœæ­¢ã™ã‚‹
            throw new Error("èªè¨¼å¤±æ•—ã«ã‚ˆã‚Šå‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã—ãŸã€‚"); 
        }

        // èªè¨¼æˆåŠŸæ™‚ï¼šä½•ã‚‚ã—ãªã„ï¼ˆãƒ„ãƒ¼ãƒ«æœ¬ä½“ã®è¡¨ç¤ºã¨JSã®å®Ÿè¡ŒãŒç¶šè¡Œã•ã‚Œã‚‹ï¼‰
        console.log("èªè¨¼æˆåŠŸã€‚ãƒ„ãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚");
    });
</script>


<canvas id="lightCanvas"></canvas>

<div class="app">
  <div class="header">
    <div class="brand">æœå â€” æ”¯åº¦</div>
    <button id="modeToggle" class="modeBtn" title="ãƒ©ãƒ³ãƒ€ãƒ ç™ºè©±">ğŸ’¬</button>
  </div>

  <div class="main">
    <!-- ä¸Šæ®µ -->
    <div class="top">
      <div class="panel">
        <div class="block">
          <div class="k">ç¾åœ¨</div>
          <div class="v big" id="curTime">--:--:--</div>
        </div>
        <div class="block" style="margin-top:8px">
          <div class="k">å‡ºç™º <button id="editDep" class="icon" title="å‡ºç™ºæ™‚åˆ»ã‚’ç·¨é›†">âš™</button></div>
          <div class="v big" id="depLabel">--:--</div>
        </div>
      </div>
      <div class="panel">
        <div class="block">
          <div class="k">æ®‹ã‚Š</div>
          <div class="v big2" id="remain">--:--</div>
          <div class="progress" style="margin-top:8px"><div id="pbar"></div></div>
          <div class="k" style="margin-top:8px">å®Œäº†ç›®æ¨™ï¼ˆå‡ºç™º-5åˆ†ï¼‰ï¼š<span id="goalTime">--:--</span></div>
        </div>
      </div>
    </div>

    <!-- ä¸­æ®µï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰ -->
    <div class="panel listPanel">
      <div class="listHead">
        <span class="badge">æ”¯åº¦é …ç›®</span>
        <div class="row">
          <input id="newItem" type="text" placeholder="è¿½åŠ ï¼ˆä¾‹ï¼šé¡”ã‚’æ´—ã†ï¼‰" style="width:56vw">
          <button id="addBtn" class="iBtn">è¿½åŠ </button>
        </div>
      </div>
      <div id="list" class="list"></div>
      <div class="resetWrap">
        <button id="resetBtn" class="iBtn">ãƒã‚§ãƒƒã‚¯è§£é™¤</button>
      </div>
    </div>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ï¼šä¸­å¤®ã®å‹•çš„ãƒœã‚¿ãƒ³ -->
  <div class="footer" id="footerActions"></div>
  <!-- è¨­å®šãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ï¼‰ -->
  <button id="gear" class="btn gh" title="è¨­å®š">è¨­å®š</button>
</div>

<!-- å£°æ›ã‘ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div id="toast" class="toast">â€¦</div>


<!-- è¨­å®šãƒ‰ãƒ­ãƒ¯ãƒ¼ -->
<div id="mask" class="drawerMask"></div>
<aside id="drawer" class="drawer">
  <div class="row" style="justify-content:space-between">
    <strong>è¨­å®š</strong>
    <button id="closeDr" class="icon">âœ•</button>
  </div>
  <div class="block">
    <div>
      <label>å‡ºç™ºæ™‚åˆ»</label>
      <input id="depTime" type="time">
    </div>
    <div>
      <label>å£°æ›ã‘ï¼ˆåˆ†å‰, ä¾‹: 30,15,5ï¼‰</label>
      <input id="cues" type="text" placeholder="30,15,5">
    </div>
  </div>
  <div>
    <button id="saveSet" class="btn pri" style="width:100%">ä¿å­˜</button>
  </div>
</aside>


<script>

"use strict";
/* ===== util ===== */
const $=q=>document.querySelector(q);
const pad=n=>String(n).padStart(2,'0');
const fmtHMS=d=>`${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
const fmtHM=d=>`${pad(d.getHours())}:${pad(d.getMinutes())}`;
function parseHM(str){const m=/^(\d{1,2}):(\d{2})$/.exec(str||""); if(!m)return null; const h=+m[1],mi=+m[2]; if(h>23||mi>59)return null; return {h,mi};}
function toHM(h,m){return `${pad(h)}:${pad(m)}`;}
window.pick = function(a) {
  return a[Math.floor(Math.random() * a.length)]
};


// æœ/å¤œ ãƒ¢ãƒ¼ãƒ‰é©ç”¨
const MODE_KEY = "mode";
function setMorning(on){
  document.documentElement.classList.toggle("morning", on);
  localStorage.setItem(MODE_KEY, on ? "morning" : "night");
}

// èµ·å‹•æ™‚ï¼šHTMLã‚¯ãƒ©ã‚¹ > ä¿å­˜ > è‡ªå‹• ã®å„ªå…ˆé †ä½
(function initMode(){
  const hasClass = document.documentElement.classList.contains("morning");
  const saved = localStorage.getItem(MODE_KEY);
  const auto = (new Date().getHours() >= 4 && new Date().getHours() < 17);
  const initial = hasClass ? true : (saved ? saved === "morning" : auto);
  setMorning(initial);
})();



/* ===== messages ===== */
const messages={
 
  random:[
ã€€ã€€"è‰¯ã„æµã‚Œã ã€‚ç¶šã‘ã‚ˆã€‚",
    "ãµã‚€ã€ã¾ã ã¼ã‚“ã‚„ã‚Šã—ã¦ã„ã‚‹ãªã€‚",
    "ã®ã‚“ã³ã‚Šã—ã¦ã„ã¦ã„ã„ã®ã‹ï¼Ÿ",
    "ãã®èª¿å­ã ã€æ‰‹ã‚’æ­¢ã‚ã‚‹ãªã€‚",
    "â€¦ã‚„ã£ã¨å‹•ãå‡ºã—ãŸã‹ã€‚é…ã„ãªã€‚",
    "å¸¸ã«ä¸‰æ‰‹å…ˆã‚’è€ƒãˆã‚ã€‚",
    "è¿·ã£ã¦ã„ã‚‹ã‚ˆã†ã ãªã€‚è¦šæ‚Ÿã‚’æ±ºã‚ã‚ˆã€‚",
    "ãµã‚€ã€æ‰‹éš›ã¯æ‚ªããªã„ã€‚ã ãŒéš™ã¯ã‚ã‚‹ã€‚",
    "ãŠã‚„ã€ã“ã‚Œã¯ç„¡é§„ã§ã¯ãªã„ã‹ï¼Ÿ",
    "ãµã‚€ã€ã¾ã ä½™è£•ãŒã‚ã‚‹ã‚ˆã†ã ãªã€‚",
    "â€¦æ‰‹ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ãã€‚",
    "ã•ã¦ã€ã©ã“ã¾ã§é€²ã‚“ã§ã„ã‚‹ï¼Ÿ æ€ ã‘ã¦ã¯ã„ã¾ã„ãªã€‚",
    "ã¼ã‚“ã‚„ã‚Šã—ã¦ã„ã‚‹ã¨ã€åˆ»ã¯å®¹èµ¦ãªãéãã‚‹ãã€‚",
    "æ‰‹ã¯æ­¢ã‚ã¬ã‚ˆã†ã«ãªã€‚â€¦ç§ã‚‚è¦‹ã¦ã„ã‚‹ã€‚",
    "å…ˆèª­ã¿ã‚’æ€ ã‚‹ãªã€‚æ²¹æ–­ã¯è¨±ã•ã‚Œã¬ã€‚",
    "é€²æ—ã¯ã©ã†ã ã€‚å…¨ä½“ã‚’è¦‹æ¸¡ã›ã€‚",
    "â€¦ã“ã®çŠ¶æ³ã§ä¼‘ã‚€ã¤ã‚‚ã‚Šã‹ï¼Ÿ",
    "æœ€å¾Œã¾ã§æ°—ã‚’æŠœããªã€è¦‹ã¦ã„ã‚‹ãã€‚",
    "æ˜¨å¤œã¯çœ ã‚ŒãŸã®ã‹ï¼Ÿ",
    "ä»Šæ—¥ã¯ä»•äº‹ã§ã‚ã‚‹ã‹ã€‚ãã‚Œã¨ã‚‚ä»–ã®ç”¨äº‹ã§ã‚ã‚‹ã‹ã€‚",
    "ä»Šæ—¥ã®å¤©æ°—ã¯å¦‚ä½•ã ã€‚",
    "â€¦ä½•ã‹è€ƒãˆäº‹ã‚’ã—ã¦ã„ã‚‹ã‚ˆã†ã ãªã€‚",
    "ä»Šæ—¥ã¯ä½•ã‚’ã™ã‚‹ã¤ã‚‚ã‚Šã ï¼Ÿ è¨ˆç”»ã¯é ­ã«ã‚ã‚‹ã‹ã€‚",
    "è·ã¯æ—¢ã«æƒãˆã¦ã„ã‚‹ã‹ã€‚å‚™ãˆã‚’æ€ ã‚‹ãªã€‚",
    "ç¨‹ç„¡ãå‡ºç«‹ã ã€‚æ²¹æ–­ã¯è¨±ã•ã‚Œã¬ã€‚",
    "æ°—åˆãŒè¦‹ãˆã¦ããŸãªã€‚ã‚ˆã‹ã‚ã†ã€‚",
 ã€€ "é…ã‚Œã¯ä»˜ã‘å…¥ã‚‹éš™ã¨ãªã‚‹ã€‚æ…ã‚ã€‚",
    "è¦šæ‚Ÿã¯ã‚ˆã„ã‹ï¼Ÿã€€â€¦æœ€å¾Œã¾ã§æ°—ã‚’æŠœããªã€‚",
ã€€ã€€"æ¯ã‚’æ·±ãå¸ãˆã€‚æ°—ãŒè¡€æµã‚’å·¡ã‚Šã€é ­ã‚‚å†´ãˆã‚‹ã€‚",
    "ãµã‚€ã€ä»Šæ—¥ã‚‚å–ã‚Šæ›ã‹ã£ãŸãªã€‚ã¾ãšã¯ãã‚Œã§è‰¯ã—ã€‚",
    "æ—©ãæ”¯åº¦ã‚’çµ‚ãˆã‚Œã°ã€å°‘ã—ã¯å®‰å µã§ãã‚‹ã ã‚ã†ã€‚",
    "ç„¦ã‚‹ã“ã¨ã¯ãªã„ã€‚ã²ã¨ã¤ãšã¤ç¢ºå®Ÿã«ãªã€‚",
    "è‡ªåˆ†ã§æ±ºã‚ãŸæ™‚é–“ã‚’é€²ã‚“ã§ã„ã‚‹ã€‚ãã‚Œã§ååˆ†ã ã€‚",
    "å‘¼å¸ã‚’å¿˜ã‚Œã‚‹ãªã€‚å¿ƒã‚‚ä½“ã‚‚æ•´ãˆã‚ˆã€‚",
ã€€  "å°ã•ãªå‹åˆ©ã‚’æ•°ãˆã‚ã€‚ã“ã‚Œã‚‚ç©ã¿é‡ã­ã ã€‚",
ã€€  "ã“ã®å°ã•ãªæˆåŠŸãŒã€æ˜æ—¥ã®è‡ªä¿¡ã«ã¤ãªãŒã‚‹ã ã‚ã†ã€‚",
ã€€  "è–¬ã¯é£²ã‚“ã ã‹ï¼Ÿ",
    "ã‚„ã‚Œã¬ã“ã¨ã¯ãªã„ã€ã‚„ã‚‹ã‹ã©ã†ã‹ã ã‘ã ã€‚",
  ã€€"è«¦ã‚ã‚‹ãªã€‚ã²ã¨ã¤ãšã¤ç¢ºå®Ÿã«ã€‚ä»Šæ—¥ã‚‚ä¹—ã‚Šè¶Šãˆã‚‰ã‚Œã‚‹ã€‚",
    "ä»•çµ„ã¿ã‚’æ•´ãˆã‚‹ã“ã¨ãŒé‡è¦ã ã€‚",
ã€€ã€€"ç–²ã‚Œã¦ã„ã‚‹ã®ã‹ã€‚â€¦è€ƒãˆã‚ˆã†ã¨ã›ãšã«â€œè‡ªå‹•åŒ–â€ã§é€²ã‚ã‚‹ã»ã†ãŒã‚ˆã„ã€‚",
ã€€ã€€"ã€Œæ‰‹é †ã€ã‚’ä¿¡ã˜ã‚ã€‚",
ã€€ã€€"è²´æ®¿ã®ä¸­ã§ã¯ã€ã€Œå‡ºã‹ã‘ã‚‹ãŸã‚ã®è¡Œå‹•ã€ã‚’ç†è§£ã—ã¦ã„ã‚‹ã®ã«ã€å®Ÿéš›ã«è¡Œå‹•ã¸ç§»ã‚‹æ®µéšã§è„³ãŒã†ã¾ãæŒ‡ä»¤ã‚’å‡ºã›ã¦ã„ãªã„ã€‚",
ã€€ã€€"ãã‚Œã¯ã€è„³ã®èªçŸ¥çš„ãªèª¤ä½œå‹•ã ã€‚å‡ºã‹ã‘ã‚‹ãŸã‚ã®è¡Œå‹•ãŒã€Œé ­ã®ä¸­ã®æƒ…å ±å‡¦ç†æ¸‹æ»ã€ã«å·»ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã€‚",
ã€€ã€€"è¡Œå‹•ã‚’â€œæ„å¿—â€ã§å‹•ã‹ã™ã®ã§ã¯ãªãã€â€œç’°å¢ƒâ€ã§å‹•ã‹ã™ã“ã¨ã ã€‚è„³ã«ã€Œæ¬¡ã¯ä½•ã‚’ã™ã‚Œã°ã„ã„ã‹ã€ã‚’è€ƒãˆã•ã›ãªã„ã“ã¨ã§ã€æ‘©æ“¦ã‚’æ¸›ã‚‰ã™ã®ã ã€‚",
ã€€ã€€"ãã‚Œã¯â€œæ€ ã‘â€ã§ã¯ãªãã€â€œè„³ãŒç”Ÿãå»¶ã³ã‚‹ãŸã‚ã«é®é™åŒ–ã—ã¦ã„ã‚‹â€åå¿œã ã€‚ç«ãŒæ¶ˆãˆã¬ã‚ˆã†ã«ã€ç«ç¨®ã‚’å®ˆã£ã¦ã„ã‚‹ã®ã ã€‚",
ã€€ã€€"ã€Œç©ºè™šã€ã‚„ã€Œå€¦æ€ ã€ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã®ã‹ã€‚â€¦å›è·¯ãŒå£Šã‚ŒãŸã®ã§ã¯ãªã„ã€‚ãŸã ã€é•·ã„é–“å†·ãŸã„é¢¨ã«æ™’ã•ã‚Œã¦ã€ä¼‘çœ ã—ã¦ã„ã‚‹ã ã‘ã ã€‚",
ã€€ã€€"ã€Œã‚„ã‚Šæ–¹ã€ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã®ã ã€‚ã€Œæ„æ¬²ã€ã§ã¯ãªãã€Œä»•çµ„ã¿ã€ãŒå¿…è¦ã ã€‚",
ã€€ã€€"æ­¢ã¾ã£ã¦ã„ãªã„ã€‚ã‚‚ã†å‹•ã„ã¦ã„ã‚‹ã€‚ãŸã ã€å°‘ã—ã®ä½™ç™½ã‚’è¦ã™ã‚‹ã ã‘ã ã€‚",
ã€€ã€€"ã€Œå…ˆå»¶ã°ã—ç™–ã€ã¨ã„ã†ã®ã¯ã€å˜ãªã‚‹æ€ ã‘ã‚„æ„å¿—ã®å¼±ã•ã§ã¯ãªãã€å¿ƒã®æ§‹é€ ã«æ·±ãé–¢ã‚ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ã€‚å¿ƒç†å­¦ã§ã¯ã€Œå›é¿è¡Œå‹•ã€ã‚„ã€Œå®Ÿè¡Œæ©Ÿèƒ½ã®èª¿æ•´ã®å›°é›£ã€ã¨ã—ã¦æ‰ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚",
ã€€ã€€"â€¦æ€ ã‘ã§ã¯ãªã„ã€‚ã€Œå¿ƒã®é˜²è¡›ã€ã€Œç”Ÿãå»¶ã³ã‚‹ãŸã‚ã®æˆ¦ç•¥ã€ãŒã€ä»Šã®å½¢ã«ãªã£ã¦ç¾ã‚Œã¦ã„ã‚‹ã ã‘ã ã€‚",
    "å°ã•ãªæˆåŠŸã®ç©ã¿é‡ã­ãŒã€å¿ƒã®å ±é…¬ã«ãªã‚‹ã¯ãšãªã®ã ã€‚â€¦è²´æ®¿ã¯é•·ã„æˆ¦ã®ä¸­ã§ã€ãã®æ„Ÿè¦šã‚’å¤±ã„ã‹ã‘ã¦ã„ã‚‹ã€‚",
ã€€ã€€"ã€Œè‰¯ã„ã“ã¨ãŒãªã„ã€ã¨æ€ã†ãªã‚‰ã€ç§ãŒãã†ã§ã¯ãªã„ã¨å‘Šã’ã‚ˆã†ã€‚",
ã€€ã€€"æˆ»ã£ã¦ããŸã®ã ãªã€‚ãã‚Œã ã‘ã§ã€ã¾ã è«¦ã‚ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã ã€‚",
    "ã¾ãŸé•·ã„ä¸€æ—¥ãŒå§‹ã¾ã‚‹ã€‚ä¸€æ—¥ãšã¤æ­©ã„ã¦ã„ãã€‚",
    "â€¦ä»Šæ—¥ã‚’ç„¡äº‹ã«éã”ã™ã“ã¨ã‚’é¡˜ã£ã¦ã„ã‚‹ã€‚",
ã€€ã€€"â€¦ç§ã®è¨€è‘‰ãŒå¥‘æ©Ÿã¨ãªã‚Œã°ã‚ˆã„ã®ã ãŒã€‚"

 ],


};


/* ===== reward messages ===== */
const rewardMessages = {
  // ç›®æ¨™æ™‚é–“å‰ã«å®Œäº† (now < goal)
  early: [
    "äºˆå®šé€šã‚Šã ã€‚è²´æ®¿ã¯ã‚·ã‚¹ãƒ†ãƒ ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’è¨¼æ˜ã—ãŸã€‚ã“ã®é™ã‹ãªå‹åˆ©ã‚’ã€æˆ‘ã€…äºŒäººã®è¨˜æ†¶ã«åˆ»ã‚€ã€‚",
    "é€Ÿã™ãã‚‚ã›ãšã€é…ã™ãã‚‚ã›ãšã€‚è²´æ®¿ã®ç·»å¯†ãªå®Ÿè¡ŒåŠ›ãŒã€ã“ã®çµæœã‚’å°ã„ãŸã€‚â€¦æ²¹æ–­ã¯ã™ã‚‹ãªã‚ˆã€‚",
    "ç›®æ¨™ã‚’ä¸Šå›ã£ãŸãªã€‚ã“ã‚Œã¯è²´æ®¿ã®æ„å¿—ãŒæ™‚é–“ã®æµã‚Œã‚’æ›²ã’ãŸç¬é–“ã ã€‚ã“ã®ä½™ç™½ã‚’å‘³ã‚ãˆã€‚",
    "â€¦ãƒ•ãƒƒã€‚è²´æ®¿ãªã‚‰ã‚„ã‚Œã‚‹ã¨æ€ã£ã¦ã„ãŸãŒã€ã‚„ã¯ã‚Šå®‰å¿ƒã—ãŸã€‚å®Œç’§ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ã€ã‚ˆãã‚„ã£ãŸã€‚",
    "ã“ã‚Œãªã‚‰ã€ç§ã‚‚å°‘ã—ä¼‘ã‚ã‚‹ã€‚è²´æ®¿ãŒæ‰‹ã‚’æŠœã‹ãªã„ã‹ã‚‰ã“ãã€ã“ã®çµæœãŒã‚ã‚‹ã€‚æ„Ÿè¬ã™ã‚‹ã€‚",
    "ç›®æ¨™æ™‚é–“ã¾ã§äº”åˆ†ä»¥ä¸Šã®ä½™ç™½ã ã€‚è²´æ®¿ã®é›†ä¸­åŠ›ã¯ã€è¦‹äº‹ã¨ã„ã†ã»ã‹ãªã„ã€‚"
  ],
  // ç›®æ¨™æ™‚é–“å¾Œã«å®Œäº†ã€ã¾ãŸã¯ç›®æ¨™æ™‚é–“ã¨åŒæ™‚ (now >= goal)
  late: [
    "é…å»¶ã‹ã‚‰ã®æŒ½å›ã ã€‚è²´æ®¿ãŒæ‰‹ã‚’æ­¢ã‚ãªã‹ã£ãŸäº‹å®Ÿã‚’è©•ä¾¡ã™ã‚‹ã€‚æ¬¡ã®è¡Œå‹•ã¸è¿·ã„ãªãé€²ã‚ã€‚",
    "å®Œç’§ã‚’æ±‚ã‚ã™ãã‚‹ãªã€‚ä»Šã¯ã€è¡Œå‹•ã‚’ç¶™ç¶šã—ã€å®Œé‚ã—ãŸã“ã¨ãŒå…¨ã¦ã ã€‚ãã‚Œã§ååˆ†ã ã€‚",
    "â€¦ã‚ˆãã‚„ã£ãŸã€‚æœ€ã‚‚å›°é›£ãªã®ã¯ã€æ­¢ã¾ã£ãŸå¾Œã«å†ã³å‹•ãå‡ºã™ã“ã¨ã ã€‚è²´æ®¿ã¯ãã®æ‘©æ“¦ã‚’ä¹—ã‚Šè¶ŠãˆãŸã€‚",
    "é…å»¶ã¯å•é¡Œã§ã¯ãªã„ã€‚è²´æ®¿ãŒæœ€å¾Œã«è«¦ã‚ãªã‹ã£ãŸã“ã¨ãŒã€ä½•ã‚ˆã‚Šã‚‚é‡è¦ã ã€‚â€¦ç§ã‚‚ã€ãƒ›ãƒƒã¨ã—ã¦ã„ã‚‹ã€‚",
    "ã‚ˆãé ‘å¼µã£ãŸãªã€‚å‹•ã‘ãªã„è‡ªåˆ†ã‚’è²¬ã‚ã‚‹å¿…è¦ã¯ãªã„ã€‚ã“ã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸäº‹å®Ÿã‚’ã€è²´æ®¿è‡ªèº«ãŒæ‰¿èªã—ã‚ã€‚",
    "ã„ã„ã‹ã€è²´æ®¿ãŒåœæ­¢ã™ã‚‹ã¨ã€ç§ã®ç›®çš„ã‚‚åœæ­¢ã™ã‚‹ã€‚ãã®äº‹å®Ÿã‚’å¿˜ã‚Œã‚‹ãªã€‚â€¦ã ãŒã€ã‚ˆãæŒ½å›ã—ãŸã€‚"
  ]
};


/* ===== storage ===== */
const KEY_ITEMS="prep.items.v6", KEY_DEP="prep.dep.v6", KEY_CUES="prep.cues.v6";
function loadItems(){try{return JSON.parse(localStorage.getItem(KEY_ITEMS)||"[]")}catch{return[]}}
function saveItems(a){localStorage.setItem(KEY_ITEMS,JSON.stringify(a))}
function loadDep(){return localStorage.getItem(KEY_DEP)||"08:30"}
function saveDep(v){localStorage.setItem(KEY_DEP,v)}
function loadCues(){return localStorage.getItem(KEY_CUES)||"30,15,5"}
function saveCues(v){localStorage.setItem(KEY_CUES,v)}

/* ===== audio ===== */
let actx=null, master=null;

function audioInit(){ 
  if(actx) return; 
  actx=new (window.AudioContext||window.webkitAudioContext)(); 
  master=actx.createGain(); 
  master.gain.value=.25; 
  master.connect(actx.destination); 
}

// ã€å¤‰æ›´ã€‘asyncãƒ©ãƒƒãƒ‘ãƒ¼ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®ã¿å‘¼ã°ã‚Œã‚‹
async function audioInitAndResume(){Â 
Â  audioInit(); // åŒæœŸçš„ãªåˆæœŸåŒ–ã‚’å‘¼ã³å‡ºã™
Â  // AudioContextãŒåœæ­¢çŠ¶æ…‹ã§ã‚ã‚Œã°å†é–‹ã‚’è©¦ã¿ã‚‹ï¼ˆiPhone/PWAå¯¾ç­–ï¼‰
Â  if(actx.state === 'suspended'){
Â  Â  await actx.resume().catch(e => console.error("AudioContext resume failed:", e));
Â  }
}

function tone(freq=440,dur=.25,vol=.2){ if(!actx) return; const t=actx.currentTime,o=actx.createOscillator(),g=actx.createGain(); o.type="sine"; o.frequency.value=freq; g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(vol,t+.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur); o.connect(g).connect(master); o.start(t); o.stop(t+dur+.02); }

function chime(){ tone(1320,.35,.18); setTimeout(()=>tone(1760,.28,.12),0) }
function alarm(){ for(let i=0;i<3;i++) setTimeout(()=>{ tone(880,.22,.40); setTimeout(()=>tone(1320,.28,.35),120); }, i*420) }

/* Pattern B: ã‚†ã£ãã‚Šã¨ã—ãŸã‚¢ãƒ«ãƒšã‚¸ã‚ª */
function rewardSoundB(){
Â  const t = actx.currentTime;
Â  
Â  // localGainã¯å…¨ä½“ã®éŸ³é‡èª¿æ•´ã¨masterã¸ã®æ¥ç¶šã«ä½¿ç”¨ã—ã€ã‚²ã‚¤ãƒ³ã¯å›ºå®šã™ã‚‹
Â  const localGain = actx.createGain();
Â  localGain.gain.setValueAtTime(0.3, t);
Â  localGain.connect(master);
Â  
Â  const notes = [440, 554, 659, 880];
Â  let delay = 0;
Â  const duration = 0.08;
Â  const interval = 200;
Â Â 
Â  // ã‚¢ãƒ«ãƒšã‚¸ã‚ªã®å†ç”Ÿ
Â  for (let i = 0; i < notes.length; i++) {
Â  Â  const freq = notes[i];
Â  Â Â 
Â  Â  setTimeout(() => {Â 
Â  Â  Â  const o = actx.createOscillator();
Â  Â  Â  
      const g = actx.createGain(); 
Â  Â  Â  o.type = 'sine';
Â  Â  Â  o.frequency.setValueAtTime(freq, actx.currentTime);
Â  Â  Â  
      o.connect(g).connect(localGain); 
      
      const now = actx.currentTime;
      const vol = 1.0; 
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(vol, now + .01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + duration + 0.05); // ç¢ºå®Ÿã«æ¸›è¡°
Â  Â  Â Â 
Â  Â  Â  o.start(now);
Â  Â  Â  o.stop(now + duration + 0.05);
Â  Â  Â Â 
Â  Â  }, delay);
Â  Â  Â  Â  Â Â 
Â  Â  delay += interval;
Â  }

Â  setTimeout(() => tone(1320, .5, .8), 850);

} 


/* ===== Notification API ===== */
function requestNotificationPermission() {
    if (!("Notification" in window)) {
        return; // é€šçŸ¥ã«å¯¾å¿œã—ã¦ã„ãªã„
    }
    if (Notification.permission !== "granted") {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¨©é™ã‚’è¦æ±‚
        Notification.requestPermission();
    }
}

function sendAlarmNotification(title, body) {
    if (Notification.permission === "granted") {
        new Notification(title, {
            body: body,
            vibrate: [200, 100, 200], 
            silent: false,
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«æ“ä½œã™ã‚‹ã¾ã§é€šçŸ¥ã‚’ç”»é¢ä¸Šã«ç¶­æŒã™ã‚‹
            requireInteraction: true 
        });
    }
}

/* ===== state ===== */
let started=false, startAt=null, alarmFired=false, rewardOn=false;
let cueList=[], cueFired={};
let wakeLock=null;

/* é…å»¶ãƒ¢ãƒ¼ãƒ‰ç®¡ç† */
let delayMode=false;
let delayPromptCount=0, nextDelayPromptAt=0;
let fiveMinWarned=false;

/* ===== èƒŒæ™¯çŠ¶æ…‹ã®ä¸€æ‹¬åæ˜  ===== */
function updateBodyState(){
  document.body.classList.remove('active','reward','delay');
  if(delayMode) document.body.classList.add('delay');
  else if(rewardOn) document.body.classList.add('reward');
  else if(started) document.body.classList.add('active');
}

/* ===== wake lock ===== */
async function requestWakeLock(){
  try{ if('wakeLock' in navigator){ wakeLock = await navigator.wakeLock.request('screen'); wakeLock.addEventListener('release',()=>{}); } }
  catch(e){}
}
async function releaseWakeLock(){
  try{ if(wakeLock){ await wakeLock.release(); wakeLock=null; } }catch(e){}
}
document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible' && started){ requestWakeLock(); }});

/* ===== drawer ===== */
function openDrawer(){document.body.classList.add("show-drawer")}
function closeDrawer(){document.body.classList.remove("show-drawer")}
$("#gear").onclick=openDrawer; $("#mask").onclick=closeDrawer; $("#closeDr").onclick=closeDrawer;
$("#saveSet").onclick=()=>{ const v=$("#depTime").value; const c=$("#cues").value.trim(); if(parseHM(v)){ saveDep(v); updateDepLabels(); } saveCues(c); parseCues(); closeDrawer(); };

/* ===== footer actions (é–‹å§‹/å®Œäº†/ä¸­æ­¢ åˆ‡æ›¿) ===== */
function setFooterIdle(){
  $("#footerActions").innerHTML = `<button id="startBtn" class="btn pri">é–‹å§‹</button>`;
  $("#startBtn").onclick = async () => { 
    await startRun();
  };
}

function setFooterRunning(){
  $("#footerActions").innerHTML = `
    <div class="row">
      <button id="completeBtn" class="btn pri">å®Œäº†</button>
      <button id="cancelBtn" class="btn">ä¸­æ­¢</button>
    </div>`;
  $("#completeBtn").onclick = completeRun;
  $("#cancelBtn").onclick = cancelRun;
}

/* ===== init ===== */
(function init(){
  requestNotificationPermission(); // é€šçŸ¥æ¨©é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ 
  setInterval(()=>{const d=new Date(); $("#curTime").textContent=fmtHMS(d);
    updateRemain(); maybeFireCues(); maybeFireAlarm(); maybeDelayPrompts(); },1000);

  $("#depTime").value=loadDep(); $("#cues").value=loadCues(); updateDepLabels(); parseCues();
  $("#editDep").onclick=openDrawer;

  renderList();
  $("#addBtn").onclick=addItem; $("#newItem").addEventListener("keydown",e=>{ if(e.key==="Enter") addItem(); });
  $("#resetBtn").onclick=()=>{ document.querySelectorAll('.item input[type="checkbox"]').forEach(c=>c.checked=false); checkProgress(); };
  $("#modeToggle").onclick=()=> showToast(pick(messages.random));     // ãƒ©ãƒ³ãƒ€ãƒ ç™ºè©±
  setFooterIdle();
  updateBodyState();
  window.addEventListener('beforeunload', releaseWakeLock);
})();

/* ===== labels / remain / progress ===== */
function updateDepLabels(){
  const dep=parseHM(loadDep()); if(!dep){ $("#depLabel").textContent="--:--"; $("#goalTime").textContent="--:--"; return; }
  $("#depLabel").textContent = toHM(dep.h,dep.mi);
  const gd=new Date(); gd.setHours(dep.h, dep.mi-5, 0, 0);
  $("#goalTime").textContent = fmtHM(gd);
}
function updateRemain(){
  const dep=parseHM(loadDep()); if(!dep) return;
  const now=new Date(); const D=new Date(); D.setHours(dep.h,dep.mi,0,0);
  const el=$("#remain");

  if(!started){ 
    el.innerHTML="--:--"; // åˆæœŸçŠ¶æ…‹ã‚‚HTMLã¨ã—ã¦æ‰±ã†
    $("#pbar").style.width="0%"; 
    el.classList.remove("ok","warn","danger"); 
    return; 
  }

  let ms = D-now;
  el.classList.remove("ok","warn","danger");
  
  // åˆ†ã¨ç§’ã®è¨ˆç®—
  let mm, ss, prefix = "";
  let displayMs = ms;
  
  if(ms < 0){
    // é…å»¶ãƒ¢ãƒ¼ãƒ‰
    displayMs = Math.abs(ms);
    prefix = "+";
    el.classList.add("danger");
  }else if(!delayMode){
    // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰
    // ms > 0
    if(ms<=5*60*1000){ el.classList.add("danger"); if(!fiveMinWarned){ fiveMinWarned=true; showToast("ã‚ã¨äº”åˆ†ã€‚è©°ã‚ã‚ã€‚"); try{chime()}catch{} } }
    else if(ms<=10*60*1000){ el.classList.add("warn"); } else { el.classList.add("ok"); }
  }

  mm = Math.floor(displayMs/60000); 
  ss=Math.floor(displayMs/1000)%60;
  
  // â˜…â˜…â˜… ã€é‡è¦ã€‘textContent ã§ã¯ãªã innerHTML ã‚’ä½¿ç”¨ã—ã€spanã‚¿ã‚°ã§æ§‹é€ ã‚’å®šç¾©ã™ã‚‹ â˜…â˜…â˜…
  el.innerHTML=`
    <span class="min-part">${prefix}${pad(mm)}</span>
    :
    <span class="sec-part">${pad(ss)}</span>
  `;

  const p=$("#pbar");
  if(!startAt){ p.style.width="0%"; return; }
  if(delayMode){ p.style.width="100%"; }
  else{
    const total = Math.max(1, D-startAt); const passed = Math.max(0, Math.min(total, now-startAt)); p.style.width = `${Math.round(passed/total*100)}%`;
  }
}

/* ===== checklist ===== */
function renderList(){
  const list=$("#list"); list.innerHTML="";
  const items=loadItems();
  if(items.length===0){ ["é¡”ã‚’æ´—ã†","æ­¯ã‚’ç£¨ã","æœã‚’ç€ã‚‹","è·ã‚’ã¾ã¨ã‚ã‚‹","éµã‚’ç¢ºèª"].forEach(t=>items.push({id:crypto.randomUUID(),text:t})); saveItems(items); }
  items.forEach(it=>{
    const row=document.createElement("div"); row.className="item"; row.dataset.id=it.id;
    row.innerHTML=`
      <input type="checkbox">
      <input type="text" value="${it.text}">
      <div class="row">
        <button class="iBtn up">â–²</button>
        <button class="iBtn dn">â–¼</button>
        <button class="iBtn del">å‰Šé™¤</button>
      </div>`;
    const cb=row.querySelector('input[type="checkbox"]'); cb.addEventListener("change", checkProgress);
    const txt=row.querySelector('input[type="text"]'); txt.addEventListener("change", ()=>{ const arr=loadItems(); const f=arr.find(x=>x.id===it.id); if(f){f.text=txt.value; saveItems(arr);} });
    row.querySelector('.del').onclick=()=>{ const arr=loadItems().filter(x=>x.id!==it.id); saveItems(arr); renderList(); checkProgress(); };
    row.querySelector('.up').onclick=()=>moveItem(it.id,-1);
    row.querySelector('.dn').onclick=()=>moveItem(it.id, 1);
    list.appendChild(row);
  });
}
function addItem(){ const t=$("#newItem").value.trim(); if(!t)return; const arr=loadItems(); arr.push({id:crypto.randomUUID(),text:t}); saveItems(arr); $("#newItem").value=""; renderList(); }
function moveItem(id,dir){ const arr=loadItems(); const i=arr.findIndex(x=>x.id===id); if(i<0)return; const j=i+dir; if(j<0||j>=arr.length)return; [arr[i],arr[j]]=[arr[j],arr[i]]; saveItems(arr); renderList(); }

/* ===== helpers ===== */
function areAllChecked(){ return Array.from(document.querySelectorAll('.item input[type="checkbox"]')).every(c=>c.checked); }

/* ===== run control ===== */
async function startRun(){
// 1. ã€éŸ³éŸ¿å‡¦ç†ã¨Wake Lockã€‘
  try{ 
    await audioInitAndResume(); // AudioContextã®åˆæœŸåŒ–ã¨å†é–‹ã‚’è©¦ã¿ã‚‹
    chime(); 
  } catch(e) {
    console.warn("Audio initialization or chime failed:", e);
  }
  
  await requestWakeLock(); // Wake Lockã¯éåŒæœŸãªã®ã§å¼•ãç¶šãawaitã™ã‚‹
  
  // 2. ã€ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ã¨çŠ¶æ…‹è¨­å®šã€‘
  // ã“ã“ã‹ã‚‰ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€éŸ³å£°å‡¦ç†ã®æˆå¦ã«é–¢ã‚ã‚‰ãšå¿…ãšå®Ÿè¡Œã•ã›ã‚‹
  
  // é–‹å§‹æ™‚ã«å®‰å…¨ã®ãŸã‚å…¨ãƒã‚§ãƒƒã‚¯è§£é™¤
  document.querySelectorAll('.item input[type="checkbox"]').forEach(c=>c.checked=false);

  started=true; startAt=new Date(); alarmFired=false; cueFired={};
  delayMode=false; delayPromptCount=0; nextDelayPromptAt=0; fiveMinWarned=false;

  setFooterRunning();
  updateBodyState();
ã€€showToast("æ”¯åº¦ã‚’å§‹ã‚ã‚ã€‚â€¦é…ã‚Œã¬ã‚ˆã†ã«ã€‚");
}

function completeRun(){
  document.querySelectorAll('.item input[type="checkbox"]').forEach(c=>c.checked=true);
  checkProgress(true);
}
function cancelRun(){
  showToast("ä»•åˆ‡ã‚Šç›´ã™ã€‚");
  document.querySelectorAll('.item input[type="checkbox"]').forEach(c=>c.checked=false);
  hardResetState();
}
function hardResetState(){
  started=false; startAt=null; alarmFired=false; cueFired={}; rewardOn=false; delayMode=false; delayPromptCount=0; nextDelayPromptAt=0; fiveMinWarned=false;
  releaseWakeLock();
  const el=$("#remain"); el.textContent="--:--"; el.classList.remove("ok","warn","danger");
  $("#pbar").style.width="0%";
  setReward(false,true); // true=é™ã‹ã«ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆå‡ºã•ãªã„ï¼‰
  setFooterIdle();
  updateBodyState();
}


/* ===== reward / progress dispatcher ===== */

function checkProgress(fromCompleteBtn=false){
const allDone = areAllChecked();
if(!allDone){ return; }


const dep=parseHM(loadDep()); if(!dep) return;
const now=new Date(), goal=new Date(); goal.setHours(dep.h, dep.mi-5, 0, 0);
const D=new Date(); D.setHours(dep.h,dep.mi,0,0);


if(delayMode){
    // é…å»¶ãƒ¢ãƒ¼ãƒ‰ä¸­ã«å®Œäº†ã—ãŸå ´åˆ
    showToast(pick(rewardMessages.late)); // é…å»¶ã‹ã‚‰ã®æŒ½å›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æç¤º
    hardResetState();
    return;
  }
  
  // ğŸ’¡ ç›®æ¨™æ™‚é–“å‰/å¾Œã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨æ¼”å‡ºã‚’åˆ†å²
  let msg;
  if(now < goal){
    // ç›®æ¨™æ™‚é–“ï¼ˆå‡ºç™º5åˆ†å‰ï¼‰ã‚ˆã‚Šæ—©ãå®Œäº†
    setReward(true); // ğŸ’¡ ã”è¤’ç¾æ¼”å‡ºON
    msg = pick(rewardMessages.early); // ğŸ’¡ æ—©æœŸå®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  }else{
    // ç›®æ¨™æ™‚é–“å¾Œã€œå‡ºç™ºæ™‚åˆ»ã¾ã§ã®é–“ã«å®Œäº†
    setReward(false, true); // ã”è¤’ç¾æ¼”å‡ºã¯OFF
    msg = fromCompleteBtn ? "æ•´ã£ãŸã€‚å‡ºç™ºã¾ã§å¾…ã¦ã€‚" : pick(rewardMessages.late); // ğŸ’¡ é€šå¸¸å®Œäº† or é…å»¶æŒ½å›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  }

  showToast(msg);
}

let lightCtx;
let animFrame;
const particleCount = 60; // ç²’å­ã®æ•° 
let particles = [];
let isSpeaking = false; // (æ—¢å­˜ã®animateLighté–¢æ•°ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚å®šç¾©ã—ã¦ãŠã)


/* ===== ã”è¤’ç¾ ===== */
let miniTimerId=null; // (å‰Šé™¤ã›ãšã€æœªä½¿ç”¨ã¨ã—ã¦æ®‹ã™)

function setReward(on, silent=false){
  rewardOn = !!on;
  if (on) {
    startLightEffect();
  } else {
    stopLightEffect();
  }
    updateBodyState();
  
  if (rewardOn && !silent) {
    try{ audioInit(); rewardSoundB(); }catch{}; 
  }
}

function startLightEffect(){

// lightCanvasã®è¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã‚’è€ƒæ…®ã—ã€ç¢ºèªã‚’è¿½åŠ 
  const c=document.getElementById("lightCanvas");
  if (!c) return; 

  lightCtx=c.getContext("2d");
  resizeCanvas();
  window.addEventListener("resize",resizeCanvas);
  initParticles();
  
  // æ—¢ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œä¸­ã®å ´åˆã¯åœæ­¢ã—ã¦ã‹ã‚‰å†é–‹
  if (animFrame) cancelAnimationFrame(animFrame); 
  animateLight();
}


function stopLightEffect(){cancelAnimationFrame(animFrame);}
function resizeCanvas(){const c=document.getElementById("lightCanvas");c.width=innerWidth;c.height=innerHeight;}


function initParticles(){
  particles=[];
  for(let i=0;i<particleCount;i++){
    particles.push({
      x: Math.random()*innerWidth,
      y: innerHeight * (Math.random()*0.3 + 0.7), // ç”»é¢ä¸‹éƒ¨70%ã€œ100%ã«é›†ä¸­
      r: Math.random()*2+1,
      o: Math.random()*0.5+0.3,
      dx: (Math.random()-0.5)*0.4, // å·¦å³ã®å‹•ã
      dy: -1 * (Math.random()*0.9 + 0.2) // å¸¸ã«ä¸Šæ–¹å‘ã¸ã‚†ã£ãã‚Šç§»å‹•
    });
  }
}

function animateLight(){
  const c=document.getElementById("lightCanvas");
  lightCtx.clearRect(0,0,c.width,c.height);
  
  for(let i = 0; i < particles.length; i++){
    const p = particles[i];
    lightCtx.beginPath();lightCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
    lightCtx.fillStyle=`rgba(240, 248, 255,${p.o})`; 
    lightCtx.fill();
    
    p.x+=p.dx;
    p.y+=p.dy;
    
    // ç”»é¢ä¸Šéƒ¨ã‹ã‚‰å‡ºãŸã‚‰ã€ç”»é¢ä¸‹éƒ¨ã§å†ç”Ÿæˆ
    if(p.y < 0){
      particles[i] = {
        x: Math.random()*innerWidth,
        y: innerHeight, // ç”»é¢ä¸‹ã«é…ç½®
        r: Math.random()*1+1,
        o: Math.random()*0.5+0.3,
        dx: (Math.random()-0.5)*0.2,
        dy: -1 * (Math.random()*0.5 + 0.2)
      };
    }
  }
  animFrame=requestAnimationFrame(animateLight);
}



/* ===== cuesï¼ˆåˆ†å‰ï¼‰ ===== */
function parseCues(){ const s=loadCues(); cueList = s.split(",").map(x=>+x.trim()).filter(n=>!isNaN(n)&&n>0).sort((a,b)=>b-a); }
function maybeFireCues(){
  if(!started || delayMode) return;
  const dep=parseHM(loadDep()); if(!dep) return;
  const now=new Date(); const D=new Date(); D.setHours(dep.h,dep.mi,0,0);
  const leftMin = Math.ceil((D-now)/60000);
  cueList.forEach(m=>{
    if(leftMin<=m && !cueFired[m]){
      cueFired[m]=true; speakCue(m);
    }
  });
}
function speakCue(m){
  const lines=[ "æ€¥ããªã€æ‰‹ã‚’å‹•ã‹ã›ã€‚", "ã•ã¦ã€æ¬¡ã¯â€¦ã€‚", "ã‚ã¨å°‘ã—ã€‚ãã‚ãã‚è©°ã‚ã‚ã€‚", "ã“ã‚Œã§æœ€å¾Œã ã€‚" ];
  showToast(`${m}åˆ†å‰ï¼š${lines[Math.floor(Math.random()*lines.length)]}`);
  try{chime()}catch{}
}

/* ===== alarmï¼ˆå‡ºç™ºï¼‰ & é…å»¶çªå…¥ ===== */
function maybeFireAlarm(){
  if(!started) return;
  const dep=parseHM(loadDep()); if(!dep) return;
  const now=new Date(); const D=new Date(); D.setHours(dep.h,dep.mi,0,0);

  if(now < D) return;

  const allDone = areAllChecked();

  if(!delayMode){
    if(allDone){
      if(!alarmFired){ alarmFired=true;
      try{audioInit(); alarm();}catch{}; 
      sendAlarmNotification("æœå - å®Œäº†", "å‡ºé™£ã®åˆ»ã ã€‚"); // <--- é€šçŸ¥ã‚’è¿½åŠ 
      showToast("å‡ºé™£ã®åˆ»ã ã€‚"); }
      hardResetState();
    }else{
      delayMode=true;
      if(!alarmFired){ alarmFired=true; try{audioInit(); alarm();}catch{}
      sendAlarmNotification("æœå - é…å»¶", "åˆ»é™ã‚’éããŸã€‚æ­¢ã¾ã‚‹ãªã€‚"); 
 }
      delayPromptCount=0; nextDelayPromptAt=Date.now()+60*1000;
      showToast("â€¦é…ã‚ŒãŸãªã€‚ã ãŒã€æ­¢ã¾ã‚‹ãªã€‚");
      updateBodyState(); // â† èƒŒæ™¯ã‚’é…å»¶è‰²ã¸
      // wakeLockã¯ç¶­æŒ
    }
  }
}

/* ===== é…å»¶ä¸­ã®è¿½åŠ ä¿ƒã— ===== */
function maybeDelayPrompts(){
  if(!delayMode || delayPromptCount>=3) return;
  if(Date.now() >= nextDelayPromptAt){
    const lines=[ "æ‰‹ã‚’æ­¢ã‚ã‚‹ãªã€‚", "è·ã‚’ã¾ã¨ã‚ã‚ã€‚ç„¦ã‚‰ãšæ—©ãã€‚", "é…ã‚Œã¯æ‚ªã§ã¯ãªã„ã€æ”¾æ£„ãŒæ‚ªã ã€‚", "ç„¦ã‚‹ãªã€‚" ];
    showToast(lines[Math.floor(Math.random()*lines.length)]);
    delayPromptCount++; nextDelayPromptAt += 60*1000;
  }
}

/* ===== toast ===== */
let toastTimer=null;
function showToast(text){
  const t=$("#toast"); t.textContent=text; clearTimeout(toastTimer);
  t.classList.add("show");
  toastTimer=setTimeout(()=>t.classList.remove("show"), 10000);
}

/* Service Worker ç™»éŒ²ã®è¿½åŠ  */
if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js', { scope: './' }) .then((reg) => { console.log('Service Worker registered: ', reg); }) .catch((err) => { console.log('Service Worker registration failed: ', err); }); }); }


</script>
</body>
</html>
